<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace属性是名称空间，必须唯一 -->
<mapper namespace="com.edu.victor.Dao.HWDao">
    <resultMap id="PageMapHw" type="Page">
        <collection property="pageData" ofType="Homework" autoMapping="true">
        </collection>
    </resultMap>
    <resultMap id="PageMapSb" type="Page">
        <collection property="pageData" ofType="SbHomework" autoMapping="true">
        </collection>
    </resultMap>
    <!--mapper返回的任然是受影响的行数，主键返回在实体的对应属性中-->
    <insert id="publishHW" useGeneratedKeys="true" keyProperty="id" parameterType="Homework">
        insert into homework(course_id,title,content,category,start_time,end_time)value (#{courseId},#{title},#{content},#{category},#{startTime},#{endTime});
    </insert>

    <select id="getHwByCourseByPage" parameterType="Page" resultMap="PageMapHw">
        select id,title,category,start_time,end_time,time from homework where course_id = #{filter.id} and category = #{filter.category} order by `time` desc
    </select>
    <select id="getSpecificHomework" resultType="HomeWork">
        select * from homework where id = #{id}
    </select>
    <select id="getSubmitedByPage" parameterType="Page" resultMap="PageMapSb">
        select hw_submit.id as id,score,status,stu.name as name,stu.username as username from hw_submit join stu on hw_submit.stu_id = stu.id where hw_id = #{filter.hwId}
    </select>
    <update id="updateHw" parameterType="Homework">
        update homework <set>
        <if test="title != null">
            title = #{title},
        </if>
        <if test="content != null">
            content = #{content}
        </if>
    </set>
    where id = #{id}
    </update>
    <update id="judgeHw" parameterType="judge">
        update hw_submit set score = #{score} where id = #{id};
    </update>
    <select id="getSubmittedHwByHw" resultType="String">
        select url from hw_submit where hw_id = #{id};
    </select>
    <select id="getUrlBySubmittedHw" resultType="String">
        select url from hw_submit where id = #{id}
    </select>
    <delete id="deleteHw">
        delete from homework where id = #{id};
    </delete>
    <select id="isPermitted" resultType="Integer">
      select count(course.id) from course join homework on homework.course_id = course.id where course.tea_id =#{teaId} and homework.id = #{hwId};
    </select>

    <!--APP端-->
    <insert id="addSubmmitedHomework" parameterType="SubmittedHomework">
        insert into hw_submit(hw_id,stu_id,url)value (#{hwId},#{stuId},#{url});
    </insert>
</mapper>
